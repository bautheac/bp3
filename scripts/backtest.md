Load
----

I load the data into two dataframes here; one for historical data
(‘data\_price\_etf.csv’ in the original github repo) and one for
qualitative data (‘data\_static\_etf\_com.csv’).

``` r
historic <- readr::read_csv(file = "../data/data_historic_etf.csv") %>%
  dplyr::mutate(Date = as.Date(Date)) %>% dplyr::arrange(Date) %>%
  tidyr::gather(`name`, price, -Date) %>% dplyr::mutate(price = as.numeric(price)) %>% 
  dplyr::filter(complete.cases(.))
static <- readr::read_csv(file = "../data/data_static_etf.csv")
```

Transform
---------

To my understanding, feature engineering here involves calculating
statistics as well as constructing TDA features at regular interval
(monthly) from the time series data at regular interval (monthly). The
resulting dataframe would contain, for each month, one sample per name
(ETF) where features include time series statistics, TDA value(s?) as
well as qualitative information (static dataframe).

### Historic features

I understand that time series statistics include return, high minus low
as well as volatility over various time horizons including past week,
past 4 weeks, past 8 weeks, past 13 weeks, past 26 weeks, past 52 weeks.

#### Returns

I calculate returns as the relative change in price over the
above-mentioned time horizons here.

``` r
sizes <- dplyr::group_by(historic, `name`) %>% dplyr::summarise(n = n())

historic %<>% dplyr::group_by(`name`) %>% dplyr::left_join(sizes, by = "name") %>%
  dplyr::mutate(
    `return - 1w` = price / dplyr::lag(price, n = 1L) - 1L,
    `return - 4w` = price / dplyr::lag(price, n = 4L) - 1L,
    `return - 8w` = price / dplyr::lag(price, n = 8L) - 1L,
    `return - 13w` = price / dplyr::lag(price, n = 13L) - 1L,
    `return - 26w` = price / dplyr::lag(price, n = 26L) - 1L,
    `return - 52w` = price / dplyr::lag(price, n = 52L) - 1L
    )

remove(sizes)
```

#### High - low

I calculate high minus low by substracting the minimum observed value
from the maximum observed value over the above-mentioned time horizons
here.

``` r
`high - low` <- function(x) max(x) - min(x)

`high - low - 4w` <- tibbletime::rollify(`high - low`, window = 4L)
`high - low - 8w` <- tibbletime::rollify(`high - low`, window = 8L)
`high - low - 13w` <- tibbletime::rollify(`high - low`, window = 13L)
`high - low - 26w` <- tibbletime::rollify(`high - low`, window = 26L)
`high - low - 52w` <- tibbletime::rollify(`high - low`, window = 52L)

historic %<>% dplyr::mutate(
  `high - low - 4w` = `high - low - 4w`(price),
  `high - low - 8w` = `high - low - 8w`(price),
  `high - low - 13w` = `high - low - 13w`(price),
  `high - low - 26w` = ifelse(`n` > 26L, `high - low - 26w`(price), NA),
  `high - low - 52w` = ifelse(`n` > 52L, `high - low - 52w`(price), NA)
  )

remove(`high - low`, `high - low - 4w`, `high - low - 8w`, 
       `high - low - 13w`, `high - low - 26w`, `high - low - 52w`)
```

#### Volatility

I calculate volatility as the annualized standard deviation of 1-week
returns over the above-mentioned time horizons here.

``` r
`volatility` <- function(x) sd(x, na.rm = T) * sqrt(52L)

`volatility - 4w` <- tibbletime::rollify(`volatility`, window = 4L)
`volatility - 8w` <- tibbletime::rollify(`volatility`, window = 8L)
`volatility - 13w` <- tibbletime::rollify(`volatility`, window = 13L)
`volatility - 26w` <- tibbletime::rollify(`volatility`, window = 26L)
`volatility - 52w` <- tibbletime::rollify(`volatility`, window = 52L)

historic %<>% dplyr::mutate(
  `volatility - 4w` = `volatility - 4w`(`return - 1w`),
  `volatility - 8w` = `volatility - 8w`(`return - 1w`),
  `volatility - 13w` = `volatility - 13w`(`return - 1w`),
  `volatility - 26w` = ifelse(`n` > 26L, `volatility - 26w`(`return - 1w`), NA),
  `volatility - 52w` = ifelse(`n` > 52L, `volatility - 52w`(`return - 1w`), NA)
  )

remove(`volatility`, `volatility - 4w`, `volatility - 8w`, 
       `volatility - 13w`, `volatility - 26w`, `volatility - 52w`)
saveRDS(historic, file = "../data/historic.rds")
```

#### TDA

I get stuck here. To my undertanding there should be TDA feature(s?) for
every month and name with the feature(s?) generated by feeding the
previous 52-week price history to TDA functions. The output dataset in
the original github repo shows 100 values (columns) for each name (row):

``` r
head(read.csv("../data/001_data_prices_20072007_18072008.csv"))
```

    #>       ADRA     ADRD     ADRE     ADRU      AGG     AUSE      AXJL      BIL
    #> 1 87.35097 87.16370 104.8893 85.06772 100.2532 86.29179  99.09799 99.91297
    #> 2 87.35097 85.64019 105.4155 83.82911 101.5193 83.81592  97.18464 99.89121
    #> 3 87.78715 87.52026 106.5380 85.44937 100.8609 84.41740  97.10264 99.78242
    #> 4 89.70631 88.36305 111.0283 86.01930 101.6408 86.23584  99.86060 99.93473
    #> 5 91.74179 89.51378 110.5679 86.89873 101.1496 85.21472  99.35766 99.86945
    #> 6 94.99855 92.93355 114.8213 89.87342 100.4760 89.28521 102.09102 99.82550
    #>        BIV      BLV      BND      BSV       BWV       CGW       CIU
    #> 1 101.5436  99.5102 100.8600 102.0952  96.85662  93.26025  99.06410
    #> 2 102.5772 100.8844 101.6879 102.4267  95.76151  90.29639  99.52903
    #> 3 102.2819 101.1156 101.4066 102.4798  96.89718  91.55501  99.62765
    #> 4 102.7248 101.4966 101.8084 102.3737  97.52586  94.61632 100.17108
    #> 5 102.0638 100.4762 101.4198 102.0155  99.63496  97.03613  99.94968
    #> 6 101.6242  99.7415 100.7100 101.6245 101.62239 100.89322  99.71319
    #>        CSD      CSJ      CVY      CWI      CZA      DBA      DBB      DBC
    #> 1 71.72343 100.4270 76.81609 91.03916 87.09853 142.6538 86.71278 160.0076
    #> 2 70.79119 100.7746 76.05977 89.25703 89.60434 155.3077 93.22898 174.7717
    #> 3 70.31304 101.0725 76.93487 91.13956 89.72071 161.6538 89.95268 176.6362
    #> 4 74.50980 100.9335 78.96552 93.07229 89.75950 160.4615 90.75355 173.4779
    #> 5 77.43412 100.7349 82.74330 94.45281 94.53064 154.2308 91.15399 166.8950
    #> 6 80.80495 100.5462 85.01916 96.23494 96.66408 156.0769 86.49436 165.9056
    #>        DBE      DBO      DBP      DBS      DBV      DDM      DEF      DEM
    #> 1 171.4726 178.0188 136.5825 134.4039 95.65674 68.02832 90.03817 104.5241
    #> 2 190.6849 198.5900 139.2621 139.2613 94.64098 63.39869 89.73282 102.5179
    #> 3 192.6370 198.0839 134.8738 134.4440 94.39580 65.49020 89.23664 101.7195
    #> 4 186.6438 190.9620 133.2427 129.4661 94.64098 66.39434 89.88550 105.9365
    #> 5 178.8014 181.5618 130.0583 128.8639 94.67601 72.50545 92.29008 108.1064
    #> 6 179.3493 182.8764 124.6990 122.0393 93.55552 78.32244 94.50382 110.8495
    #>        DES      DEW      DFE      DFJ      DGL      DGT      DHS      DIA
    #> 1 79.98462 84.74001 69.54181 83.44581 136.0122 86.09375 72.82878 87.01082
    #> 2 77.15824 80.92887 66.90678 82.39381 137.1221 83.83333 67.72421 84.02089
    #> 3 76.71602 83.81423 67.77119 84.96626 132.9889 85.93750 69.37256 85.57263
    #> 4 80.25380 84.10739 72.69774 86.64391 132.0321 86.42708 71.07409 85.88298
    #> 5 85.94501 85.60407 75.64972 86.14530 128.5496 87.50000 75.74619 89.50117
    #> 6 87.84849 88.70545 76.96328 88.61850 123.8423 91.76823 79.01453 93.17993
    #>         DIG      DIM      DJP      DLN      DLS      DNL      DOG      DOL
    #> 1  96.00207 83.49789 127.9061 82.27522 79.53141 85.82734 111.9107 91.13278
    #> 2 107.98554 80.56080 138.7084 79.42690 76.80034 85.98921 115.7588 88.91984
    #> 3 117.09711 82.52012 142.1918 80.93686 78.32112 88.25540 114.1263 91.31848
    #> 4 121.17769 85.53538 140.3327 81.64036 82.11873 87.91367 113.1934 91.51965
    #> 5 117.92355 87.53349 137.9061 85.41524 83.88673 87.65827 109.0621 92.55648
    #> 6 119.28719 89.48133 135.6164 88.55525 86.37344 90.57554 105.0808 95.18725
    #>        DON      DOO      DRW      DSI      DTD      DTH      DTN      EEB
    #> 1 83.63496 89.37816 73.40933 85.45140 81.96778 86.14043 77.88495 118.6375
    #> 2 80.97856 85.61440 72.04145 82.96197 79.24822 83.31039 74.87082 119.2288
    #> 3 81.34506 88.08405 74.81865 85.15175 80.53005 84.97782 75.93868 119.7943
    #> 4 84.35038 89.03600 76.58031 86.76527 81.56937 86.33930 77.33379 125.9640
    #> 5 88.98644 90.42056 79.56477 89.77142 85.70934 87.39483 81.43300 126.8123
    #> 6 91.38721 94.43618 79.81347 92.10526 88.46354 90.50023 84.63658 131.1054
    #>         EEM      EES      EFA      EFG      EFV      ENY      EPP      EPS
    #> 1  99.11499 80.67212 86.46316 93.23257 79.76286 114.3676 92.14516 85.56639
    #> 2  98.48157 77.61780 84.62133 91.87092 77.91100 123.0659 91.02908 84.11308
    #> 3  98.53491 77.11584 86.65636 93.46405 79.73621 126.2792 91.52424 86.06411
    #> 4 102.78527 80.89005 87.91860 95.56100 80.61684 130.2902 95.22155 86.91619
    #> 5 104.69287 85.20942 91.12571 98.50218 83.89289 130.4953 95.31217 90.02588
    #> 6 107.76040 86.23495 93.35394 99.86383 86.42419 130.6345 97.49578 92.69361
    #>        ERO      FAB       FAD       FBT      FCG      FDL      FDM
    #> 1 119.9291 79.87758  93.77127 102.18396 137.9238 67.09821 83.64566
    #> 2 120.2836 74.57153  93.02246  97.94204 152.7647 62.79464 81.43101
    #> 3 118.6688 78.03428  94.38393  95.67409 155.0339 64.28571 80.51107
    #> 4 118.4521 80.65757  97.20899  94.28811 161.7104 65.31295 84.61882
    #> 5 117.3692 84.71494  99.82982  97.18606 161.9197 68.34821 88.03237
    #> 6 115.0453 87.33823 100.30633  97.39605 159.1028 71.23616 89.99148
    #>        FDN      FEU      FEX      FEZ       FIW      FNI      FNX      GBB
    #> 1 87.69169 88.36510 84.93579 90.40140 102.81757 89.10256 89.33975 102.3911
    #> 2 89.10412 86.78034 83.47796 87.55672 100.33429 86.44689 86.21045 101.8126
    #> 3 89.26554 88.70612 85.56404 89.37173  98.94938 86.81319 87.25928 101.1955
    #> 4 91.76755 88.54564 87.71260 89.89529 104.72779 90.52198 92.65475 100.5785
    #> 5 95.92413 89.44835 90.69767 91.58813 109.78988 98.39744 95.90784 100.5785
    #> 6 97.33656 93.21966 92.28393 96.50960 112.94174 99.67949 97.42091  98.8816
    #>        GBF      GDX      GEX      GII      GLD      GMF      GMM      GSG
    #> 1 101.7231 121.8606 113.2949 102.9467 143.9688 92.13371 100.6638 153.5674
    #> 2 102.5091 124.8334 111.7742 104.6345 145.4823 91.46785 100.3255 170.6002
    #> 3 102.1765 120.6304 111.1751 106.3969 140.7430 90.40315 100.8862 172.9332
    #> 4 102.7811 123.7570 118.9631 106.1544 139.8410 92.99097 103.9548 169.2639
    #> 5 102.0455 112.3526 126.4055 106.9191 135.9884 95.49805 106.2849 163.5334
    #> 6 101.6425 110.5843 122.6498 108.1686 131.2185 99.64955 109.0430 163.0804
    #>        GSP      GVI      GWL      GWX      GXC      HGI       HYG      IAI
    #> 1 154.7640 101.7109 88.80666 81.91136 97.31326 83.33333  96.89648 64.39883
    #> 2 171.1236 102.4812 88.74499 80.80332 95.89394 83.12290  96.49031 58.00587
    #> 3 173.4831 102.5013 87.81992 81.74515 91.13096 83.24916  96.99802 63.28446
    #> 4 170.1571 102.6266 90.71847 85.65097 93.90913 87.33165  98.00042 67.09677
    #> 5 164.7640 102.1711 92.50694 85.76177 95.76593 90.48822  99.50010 71.74976
    #> 6 164.0809 101.8509 92.87697 87.39612 99.40920 92.00295 101.54135 75.26882
    #>        IAK      IAT      IAU       IBB       ICF     IDHQ      IDU
    #> 1 69.22332 62.30990 143.9389 106.54762  91.82337 82.29167 101.5819
    #> 2 67.42359 55.87393 145.0382 104.46429  87.90489 81.33013 106.6005
    #> 3 71.04397 57.24047 140.7328 101.68219  88.88754 83.33333 106.6987
    #> 4 73.11641 59.92947 139.8015  99.54710  91.01905 85.73718 106.1204
    #> 5 77.53244 63.27970 135.9084 100.15528  96.27563 86.80288 109.0879
    #> 6 80.70889 66.16707 131.0840  99.96118 100.19410 89.46314 110.1244
    #>        IDV      IEF      IEI      IEO      IEV      IEZ      IGE      IGM
    #> 1 72.38681 105.7597 105.4569 128.8246 86.34520 121.1555 112.8640 91.05634
    #> 2 68.50440 106.6570 105.9430 143.2731 84.09193 124.3670 119.7606 89.48944
    #> 3 71.03053 106.3538 105.9430 147.7939 86.19198 127.4427 122.9409 90.56338
    #> 4 75.06638 106.6327 105.8637 152.7848 87.39072 133.9167 126.4898 92.97535
    #> 5 79.08216 105.0200 104.6929 153.0199 91.02298 130.7392 125.2845 97.13028
    #> 6 80.49580 104.2076 104.0083 151.5913 93.39342 127.7485 125.5690 99.36620
    #>        IGN       IGV      IHE      IHF       IHI       IJH      IJJ
    #> 1 77.70772 103.91482 97.81493 77.25185 104.05429  93.92441 88.78459
    #> 2 77.11924  99.22564 94.77484 75.99788 101.21629  92.46438 86.71218
    #> 3 78.63248  99.72037 92.60878 76.13917  99.17151  92.24067 86.65123
    #> 4 81.23862 102.45214 91.29774 79.54786  99.77084  96.42058 90.51567
    #> 5 87.54379 106.08733 91.22174 80.28965 101.41019 100.47098 94.97745
    #> 6 89.22516 107.87266 91.63975 86.57718 103.33157 101.81326 96.81824
    #>         IJK      IJR      IJS      IJT      ILF      INP      IOO      IPE
    #> 1  99.45533 89.42508 86.25017 93.29073 120.9370 86.89103 87.84424 106.5882
    #> 2  99.03813 86.95264 83.47052 91.30693 120.4233 82.22756 86.38401 107.7034
    #> 3  98.30803 86.40155 83.24113 90.96515 121.5268 82.22756 87.99795 108.1165
    #> 4 102.88562 90.36342 86.78451 95.34141 129.2366 85.06410 87.75458 107.7241
    #> 5 106.56623 94.44444 91.29672 98.93008 129.9643 92.30769 91.14897 105.5969
    #> 6 107.10395 95.38278 92.11982 99.31644 133.3032 99.90385 93.83886 104.6055
    #>        JKD       JKE      JKF      JKG       JKH      JKI      JKJ
    #> 1 91.61638  92.85610 77.34450 89.56390  96.23981 78.77551 87.11868
    #> 2 89.87033  93.04641 75.55981 86.83535  95.44540 75.94169 84.71279
    #> 3 90.67916  93.93939 78.14593 87.84981  95.92204 77.52770 84.24082
    #> 4 90.57748  96.42805 78.91268 91.07976 100.92151 79.49854 88.32739
    #> 5 93.85030  99.00454 81.91029 95.00933 103.98263 83.45190 92.39093
    #> 6 96.73899 100.89299 85.08373 97.46968 104.74526 85.78426 93.66870
    #>        JKK      JKL      JXI      JYN      KBE      KCE      KIE      KRE
    #> 1 92.11033 84.12180 103.7074 110.8421 59.64878 68.81936 74.45911 68.82494
    #> 2 90.64785 80.01830 105.5694 111.4178 52.10343 62.36128 72.14888 61.03118
    #> 3 90.13470 80.86775 106.2677 110.9047 54.51563 67.33970 75.70590 60.91127
    #> 4 93.88069 84.81443 105.8022 111.4178 56.46469 71.00801 76.76934 66.54676
    #> 5 97.72931 90.55149 108.2959 110.1072 59.20494 76.10974 81.16978 68.27338
    #> 6 97.99872 92.61631 110.1579 109.2732 64.08723 77.57398 85.22186 69.71223
    #>         KXI      LQD      LVL      MBB       MDY     MDYG     MDYV
    #> 1  97.99752 96.15086 70.75922 100.3428  93.33333 90.62210 84.11535
    #> 2  96.82793 97.39189 69.97831 101.8350  91.85829 89.32694 82.40882
    #> 3  97.90874 97.65367 70.97614 101.2906  92.04509 90.19038 85.17405
    #> 4  98.09144 98.59414 73.70933 102.0762  96.05797 93.95893 88.65140
    #> 5 101.18731 98.63293 77.31063 101.4418  99.93559 97.14586 90.34775
    #> 6 105.49353 97.92515 78.82863 100.5949 101.51369 98.71084 91.09415
    #>        MVV      MXI       MYY       MZZ      NFO      OEF      OIL
    #> 1 78.11388 107.1942 102.98851 102.81715 87.61215 85.72271 180.9826
    #> 2 75.62278 110.9209 104.63054 106.52668 86.47343 83.80728 204.2783
    #> 3 75.97865 109.6259 105.13957 106.63167 86.54244 85.42802 203.4791
    #> 4 82.79953 117.5540 100.32841  97.86527 90.13112 85.69324 197.9076
    #> 5 89.84579 119.9223  96.90969  90.97113 92.47757 88.59584 189.9154
    #> 6 92.18268 119.6360  95.74713  88.27647 94.09938 91.83734 190.3150
    #>       ONEQ       PAF       PBD       PBE       PBJ      PBS       PBW
    #> 1 88.87457  95.89318 100.52731 101.38889  95.74599 72.47191  92.13537
    #> 2 87.19881  94.57819  97.64218  98.66667  93.46486 71.72285  86.22498
    #> 3 87.30788  95.26603  97.36347  97.16667  91.67694 73.03371  85.89133
    #> 4 90.08428  97.53186 104.70810  95.72222  93.71147 75.84270  96.23451
    #> 5 93.61428  98.37143 109.11488  97.00000  98.14982 78.96442 103.90848
    #> 6 95.56767 102.86263 106.36535  96.16667 102.11467 83.20849 102.71687
    #>         PDP      PEJ      PEY      PEZ      PFF      PFI      PFM      PGF
    #> 1  96.54625 73.03762 64.92857 75.52395 76.58598 86.04557 85.82353 76.19250
    #> 2  97.85629 69.70372 59.14286 71.63174 75.54257 83.27909 83.52941 73.50937
    #> 3  97.18142 71.53108 60.35714 72.97904 80.32137 84.98779 84.11765 79.21635
    #> 4 102.30250 74.89867 64.00000 74.43862 83.75417 87.67290 84.52941 80.91993
    #> 5 104.80349 78.95188 66.92857 78.66766 87.52087 91.17168 87.39353 84.19889
    #> 6 106.07384 81.80625 68.64286 81.21257 89.08598 92.92107 91.46765 85.81772
    #>         PGJ       PHO      PID      PIO      PJP      PKB      PKW
    #> 1  96.15235 100.00000 85.32609 83.49723 98.23789 84.59938 85.10638
    #> 2  94.52002  96.87805 82.90514 81.37876 94.71366 80.38502 82.05540
    #> 3  91.13875  96.14634 83.00395 81.69572 92.95154 80.28096 83.74147
    #> 4  97.04625 102.19024 86.26482 86.37084 92.26872 86.16025 84.82537
    #> 5  99.68908 105.70732 88.53755 90.92710 91.04626 91.57128 87.11361
    #> 6 103.84765 109.41463 92.78656 90.92710 92.23568 93.23621 90.00401
    #>        PMR      PPA      PRF     PRFZ      PRN      PSI      PSJ       PSL
    #> 1 82.01320 87.40047 81.57939 84.89848 94.87431 82.51192 92.41146  94.25891
    #> 2 78.76788 85.24590 78.80114 82.64685 91.38100 79.80922 89.42708  93.54597
    #> 3 79.15292 86.37002 80.65331 82.39666 90.49951 80.65713 89.13542  91.89493
    #> 4 80.19802 87.49415 82.21923 86.67513 94.61312 84.63169 91.35417  93.80863
    #> 5 83.66337 92.75410 85.48577 90.71791 99.18381 88.99205 94.68750  95.60826
    #> 6 85.86359 94.51991 89.43930 92.51269 99.77147 90.27875 95.72969 100.11257
    #>        PSP       PSQ      QCLN       QID      QLD     QQEW       QQQ
    #> 1 67.44472 102.70458 100.87793  99.97789 75.12797 87.51696  92.91519
    #> 2 64.41441 103.60610  97.19900 101.30444 74.32203 84.17006  92.85268
    #> 3 66.09337 103.58877  95.61037 102.18881 74.56247 85.25554  92.99854
    #> 4 71.45782 101.33495 104.05518  96.97104 78.61565 88.05970  95.12398
    #> 5 76.19574  97.88488 109.77634  90.60358 85.03473 91.81366  98.81225
    #> 6 80.75348  96.15118 108.07734  87.97258 88.11357 94.21076 100.79183
    #>       QQXT     QTEC      RCD      REM       REW      REZ       RFG
    #> 1 88.62102 86.36775 71.86611 49.35197 108.94590 90.72441  97.30268
    #> 2 84.57088 84.19384 66.98753 48.33545 112.23483 85.85159  96.86821
    #> 3 85.00482 86.91123 70.72851 49.27573 110.26147 84.93518  97.15786
    #> 4 88.04291 89.58333 72.78495 52.96061 104.09472 85.62807 100.77842
    #> 5 91.85149 92.75362 76.98534 58.55146  97.86219 91.64059 103.92469
    #> 6 93.92478 94.70109 80.26690 59.00889  92.86302 95.03800 103.34902
    #>        RFV      RGI      RHS      ROM      RPG      RPV      RSP      RSX
    #> 1 80.49133 87.79425 95.70172 70.97468 91.48477 69.05816 84.66434 122.8143
    #> 2 76.67630 85.89364 94.38225 69.11392 90.16438 65.36758 82.28290 123.8949
    #> 3 77.10983 86.48649 94.30228 70.88608 91.91593 68.40921 83.59680 125.6876
    #> 4 82.05202 88.33479 94.16234 74.84810 94.15252 70.82964 86.12195 133.1532
    #> 5 87.57225 94.07149 96.34146 81.10127 96.65858 74.16593 89.07822 135.7318
    #> 6 89.59538 96.72188 99.38025 85.32911 99.16465 77.08887 92.23979 136.2230
    #>        RTM      RWM      RWR      RWX      RXD      RXI      RXL      RYE
    #> 1 89.93599 106.3075 89.65376 76.17775 107.7337 75.92092 85.14320 114.7722
    #> 2 88.60242 109.2621 86.31407 74.77949 111.7803 72.65968 81.55020 121.7994
    #> 3 86.55761 111.0348 87.37732 76.77915 116.1856 74.60291 79.23986 127.6148
    #> 4 92.28307 106.0327 89.06761 79.20147 118.2021 76.81649 78.10863 132.4487
    #> 5 95.75036 102.2399 93.33424 82.07484 118.7405 81.04089 77.98893 130.4457
    #> 6 99.25320 101.1131 98.17339 84.02940 113.7826 84.30213 81.16116 130.0284
    #>        RYF      RYH      RYJ      RYT      RYU      RZG      RZV      SAA
    #> 1 64.14042 96.81027 88.47368 85.31322 92.88889 87.91497 72.92191 68.93479
    #> 2 58.74543 93.61100 88.00000 82.71581 95.02564 84.83401 68.26196 65.41717
    #> 3 62.87745 92.83226 89.47368 84.39649 95.43590 85.00119 68.25491 64.86066
    #> 4 64.33328 93.14977 92.63158 86.91749 94.85470 88.67925 72.34257 71.14160
    #> 5 69.02182 92.61247 96.15789 90.98549 97.09402 92.09458 75.56675 77.35182
    #> 6 72.40415 95.45371 97.63158 92.66616 99.05983 92.23788 77.78338 78.63913
    #>        SBB      SCC       SDD      SDP      SDS      SDY       SH      SHV
    #> 1 107.9420 132.1345 111.43691 89.27804 120.6260 76.97623 111.7865 100.5295
    #> 2 110.9294 144.3185 117.62217 81.47466 125.3912 73.72324 113.8286 100.4565
    #> 3 111.6618 137.5945 119.82495 81.65899 120.6436 73.36929 111.8186 100.4108
    #> 4 106.5345 130.9747 109.24872 82.35023 117.8477 75.30760 110.1624 100.5140
    #> 5 103.4324 122.1788 101.02115 79.44701 111.4296 78.37519 107.3484 100.4291
    #> 6 102.7143 112.2492  99.79577 77.52688 105.5214 82.62262 104.0360 100.3511
    #>        SHY      SIJ      SKF      SLV      SLX      SLY     SLYG     SLYV
    #> 1 102.6567 115.6870 160.4651 142.3659 133.9051 87.27360 89.58502 83.28534
    #> 2 102.7064 123.4435 202.8605 147.6824 146.0516 85.59064 88.81579 80.52102
    #> 3 102.7933 123.3913 186.5116 142.6274 140.3029 86.02340 88.39069 80.47797
    #> 4 102.8430 118.0867 175.2674 137.3108 160.8870 89.29316 92.61134 84.13475
    #> 5 102.3464 106.3478 155.8488 136.2523 161.3197 93.15595 95.63765 88.39620
    #> 6 102.0000 102.1739 142.8372 129.3955 159.6971 94.22984 96.19433 90.44054
    #>        SMN      TIP      TLH      TLO      TLT       TWM      UCC      UDN
    #> 1 60.86649 106.1647 104.0317 103.7870 103.6320 104.85095 61.74097 112.7570
    #> 2 56.94076 107.1706 105.3455 105.0493 105.5912 110.75881 56.79041 113.0998
    #> 3 59.09814 107.6586 105.1850 104.8915 105.4881 114.85095 59.93934 111.7289
    #> 4 51.19363 107.3100 105.4358 105.4430 105.7745 104.25474 63.05694 112.3378
    #> 5 48.62953 105.1687 103.4199 103.2742 102.8987  97.22222 68.07016 111.3861
    #> 6 47.88683 104.3621 102.2164 101.7949 101.8217  95.23035 74.72835 109.3679
    #>        UGE      UNG      UPW      URE      USD      USO      UUP      UWM
    #> 1 82.26907 126.5759  93.3650 67.18259 56.52508 180.8798 90.95335 73.09243
    #> 2 79.89169 140.3177 103.5186 62.53930 51.32779 203.3079 90.58824 69.94417
    #> 3 79.55256 159.6823 103.0615 64.47400 51.82103 202.3207 91.60243 67.88151
    #> 4 79.60865 157.3374 101.8842 67.52116 59.00868 197.0038 91.03448 75.21712
    #> 5 85.14682 155.4211 107.3140 75.35671 66.93198 189.0197 92.04868 81.52916
    #> 6 91.30980 150.7816 109.3645 81.45103 66.26869 189.1237 93.26572 83.28164
    #>        UXI      UYG       UYM      VAW       VB      VBK      VBR      VCR
    #> 1 69.61250 36.99674  99.53749 105.4114 88.90805 92.45069 84.88372 75.54029
    #> 2 66.04887 32.28147 108.36173 106.3920 86.92529 91.28707 82.13663 71.00687
    #> 3 66.01299 35.43707 103.63924 104.7412 86.70977 90.94650 81.54070 73.94874
    #> 4 69.28961 37.48640 122.68744 112.2130 90.66092 95.23201 85.49419 76.46172
    #> 5 77.27826 42.99964 129.97809 116.8921 94.71264 98.86477 89.97093 80.23119
    #> 6 80.97355 47.47914 131.96203 118.8408 96.11494 99.43238 92.02616 84.21846
    #>         VDC      VDE      VEA      VEU      VFH      VGK      VGT      VHT
    #> 1 100.83206 113.5406 88.87004 90.39648 66.64970 88.89195 90.45217 95.19862
    #> 2 100.56400 121.0632 86.87725 89.07489 60.69550 85.98761 89.13391 93.36788
    #> 3  99.83237 125.3039 89.10324 90.92511 63.90161 88.91948 90.22609 91.93437
    #> 4  99.40567 128.1444 90.43884 92.91630 65.90331 89.63524 92.64348 90.98446
    #> 5 101.66108 126.5797 91.62603 94.06167 70.65310 91.36958 95.65217 91.27807
    #> 6 104.80037 126.8404 93.91562 96.14097 73.89313 93.44804 98.26087 93.45423
    #>        VIG      VIS      VNQ       VO      VOE       VOT      VOX      VPL
    #> 1 91.45455 87.85238 91.87334 88.04178 82.05663  93.97786 74.80491 86.85838
    #> 2 89.97818 85.46915 88.36375 87.07572 79.69429  93.70117 74.33668 86.31632
    #> 3 90.56364 85.21040 89.00328 88.02872 81.03179  94.48242 74.07407 87.95687
    #> 4 91.03636 87.33488 90.99984 91.34465 83.48098  99.10482 76.03122 89.87779
    #> 5 94.32727 92.56435 96.94275 94.56906 86.85079 102.11589 78.86783 90.43853
    #> 6 97.49091 94.62073 99.92201 96.59269 89.50842 103.35286 81.91503 92.73904
    #>        VPU      VTI      VTV       VUG       VV       VWO      VXF
    #> 1 101.5219 87.65715 81.21345  94.74468 87.43077  97.50813 90.23353
    #> 2 106.4075 86.26797 79.21067  93.97709 86.46154  95.92633 88.63950
    #> 3 106.1900 87.53212 80.86257  94.72995 87.75385  96.38137 88.47499
    #> 4 105.1925 89.21303 81.65205  97.03764 89.20000 100.95341 92.72951
    #> 5 108.7223 92.51927 84.79518 100.21277 92.18462 101.62514 96.58693
    #> 6 109.7839 94.98507 87.73392 102.48773 94.73846 105.25460 97.75929
    #>        VYM     WMCR      XBI      XES      XHB      XLB      XLE      XLF
    #> 1 82.75928 78.09668 124.0449 123.2873 63.76866 101.7472 112.2628 61.97897
    #> 2 80.50134 77.53021 120.4015 127.4574 54.92537 101.2847 119.4161 56.01201
    #> 3 81.19020 77.00869 115.7343 130.1110 59.62687 101.3618 123.9416 59.78996
    #> 4 81.87141 80.28701 113.8243 136.7994 64.36567 107.6567 127.3723 61.67912
    #> 5 85.46690 83.64804 114.0801 134.6060 67.23881 111.5622 125.1825 66.50653
    #> 6 87.96403 84.40332 114.0606 131.8982 68.54478 114.4399 126.4234 70.10502
    #>        XLG      XLI      XLK      XLP      XLU      XLV      XLY      XME
    #> 1 85.61284 87.70136 88.92356 101.4750 102.6099 94.40143 77.51080 132.7722
    #> 2 84.35857 84.60752 86.66147 101.8533 107.7497 91.78082 72.32721 145.4655
    #> 3 85.44683 85.42572 87.16849 100.8699 107.5366 90.82787 75.72894 140.8451
    #> 4 85.46528 86.16722 89.46958 100.4539 105.8056 90.08338 77.24082 161.4565
    #> 5 87.95721 91.79238 92.62871 102.4206 108.3089 89.33889 80.93952 158.3476
    #> 6 91.54293 94.65610 95.39782 106.3540 109.9601 91.89994 85.63715 155.0842
    #>        XOP       XPH      XRT      XSD
    #> 1 133.3944 101.26482 75.04452 77.81679
    #> 2 147.8470  96.16905 70.03307 74.54198
    #> 3 153.2982  94.70964 73.74714 75.64885
    #> 4 157.0087  94.01399 74.53574 79.44656
    #> 5 157.6042  92.82457 78.45332 84.48473
    #> 6 154.4205  95.19611 82.49809 86.06870

Are there 100 TDA features? If so, why is there only 1 set of value(s?),
was expecting TDA values for each month.

#### Wrap up

``` r
historic <- readRDS(file = "../data/historic.rds")
historic %<>% dplyr::mutate(year = lubridate::year(Date), month = lubridate::month(Date), date = Date) %>%
  dplyr::group_by(name, year, month) %>% dplyr::filter(dplyr::row_number() == n()) %>% 
  dplyr::ungroup() %>% dplyr::select(-c("Date", "n", "year", "month")) %>% 
  tidyr::gather(feature, value, -c("date", "name"))
```
